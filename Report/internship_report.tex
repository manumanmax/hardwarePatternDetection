\documentclass[english,a4paper,11pt]{report}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\PassOptionsToPackage{english}{babel}
\usepackage{graphicx}
\usepackage{fullpage}
\usepackage{eso-pic}
\usepackage{cite}
\usepackage{wrapfig}
\usepackage{url}
\usepackage[english]{babel}
\usepackage{fancyhdr}
\usepackage{hyperref}
\usepackage{listings}

\usepackage[lastpage,user]{zref}
\cfoot{\thepage\ of \zpageref{LastPage}}
\pagestyle{fancy}
\usepackage[headsep=1cm,headheight=61pt,footskip=3cm]{geometry}


\newcommand{\HRule}{\rule{\linewidth}{0.5mm}}
 \newcommand{\ts}{\textsuperscript}
\newcommand{\blap}[1]{\vbox to 0pt{#1\vss}}
\newcommand\AtUpperLeftCorner[3]{%
  \put(\LenToUnit{#1},\LenToUnit{\dimexpr\paperheight-#2}){\blap{#3}}%
}
\newcommand\AtUpperRightCorner[3]{%
  \put(\LenToUnit{\dimexpr\paperwidth-#1},\LenToUnit{\dimexpr\paperheight-#2}){\blap{\llap{#3}}}%
}
\newcommand\AtLowerRightCorner[3]{%
  \put(\LenToUnit{\dimexpr\paperwidth-#1},\LenToUnit{#2}){#3}%
}
 
\title{\LARGE{Internship report pattern recognition UNISA Italy}}
\author{\textsc{Breton-Belz} Emmanuel - 2\ts{nd} Year Internship}
\date{\today}
\makeatletter

\renewcommand{\headrulewidth}{1pt}
\fancyhead[C]{\@author} 
\fancyhead[L]{\leftmark}
\fancyhead[R]{\includegraphics[width=2cm]{images_not_compressed/unisaLogo.jpg}}
\fancyhead[L]{{\includegraphics[width=2cm]{images_not_compressed/ensiLogo.jpg}}}
\addto\captionsenglish{
  \renewcommand{\contentsname}
    {Table of contents}
}
\renewcommand{\footrulewidth}{1pt}
\fancyfoot[R]{\leftmark}
		 
\begin{document}
	\setcounter{tocdepth}{4}
	\begin{titlepage}
	    \AddToShipoutPicture{%
	      \AtUpperLeftCorner{1.5cm}{1cm}{\includegraphics[width=4cm]{images_not_compressed/unisaLogo.jpg}}
	      \AtUpperRightCorner{1.5cm}{1cm}{\includegraphics[width=6.5cm]{images_not_compressed/ensiLogo.jpg}}
	      \AtLowerRightCorner{8cm}{3.5cm}{\parbox{7cm}{ENSICAEN \\
	        6, boulevard Maréchal Juin 
	        \\CS  45 053 – F- 14050 Caen Cedex 4\\
	        Tél. +33 (0)2 31 45 27 50\\
	        Fax +33 (0)2 31 45 27 60}} 
	    }
	 
	\begin{center}
	        \vspace*{10cm}
	        \textsc{\@title}
	        \HRule
	        \vspace*{0.5cm}
	        \large{\@author} 
	 \end{center}
 
    \vspace*{5cm}
    \begin{center}
      \makebox[\textwidth]{\includegraphics[width=\paperwidth]{images_not_compressed/uneGrandeEcole.png}}
    \end{center}
	
	\end{titlepage}
	\ClearShipoutPicture
	
	\input{thanks}
	
	\setcounter{secnumdepth}{2}
	\setcounter{tocdepth}{2}
	
	\tableofcontents
	\newpage
	
	\setcounter{page}{1}
	
	\input{introduction}
	
	
	
	\input{MIVIA_Lab}
	
	\input{work_to_do}
	\input{study}
	
	\input{work_done}
	
<<<<<<< HEAD
	\subsubsection[Multiple pattern]{Get many time the same pattern}

	\par On this part we extract two possible methods with Pierluigi. The easy one was to draw in black the image and than make the homography another time. The hardest one was to look for the key points and descriptor inside the corners and earase them of their containers. Than do the homography again. I began by the second one that sounded more relevent. 
	
	\par To be clear I have to present the DMatch structure that is detailed in the \hyperlink{structDMatch}{annexes}. The important attributs are the train index and the query index. They represent the fact that a descriptor has been found on the two images. But only the index of the descriptor is stored.
	
	\par I first thought I could get easily the points that gave me the corners after the homography. In fact I needed to remove the points that concern the pattern that has been recognized by the homography. There was no other way but to extract all the indexes of the points inside the corners I just found and remove them from the vectors. By chance, the homography take to vectors of points describing the positions of the descriptors (and the key points by the way). 
	\par On the first version of this algorithm I was looking if the point was in the bounds represented by the 4 segments of the rectangle of the pattern found. I found out when I was rotating the image that the points was removed the wrong way because the shape of the pattern was a lozenge. A lot of points was concidered out of the bounds and other that had nothing to do with the pattern was removed.
	\par I found on the internet a method~\cite{InOut} that provides the answer of my problem in O(n). This method find the number of edges that ligne from a point cross to the infinite with a polygon. If it is odd then the point is inside the polygon otherwise it is outside. The picture~\ref{OutIn} illustrate the idea.
	\begin{figure}[h]
		\begin{center}
			\includegraphics[width=10cm]{images_not_compressed/isIn.png}
			\caption{Illustration of the algorithm that tell if a point is inside a polygon}
			\label{OutIn}	
		\end{center}
	\end{figure}
	\subsubsection{Corners}
	\par OpenCV does not implement a structure for the corners. The corners correspond to the vertices of the polygone that represents the pattern. I isolated them in the first place beaucoup that is a good proof of the fact that the algorithm found efficiantly a pattern. It also helped me to find out that the first version of the removing point algorithm was not working perfectly.
	\par I let the structure as it is because I told myself that, in the future, the application could need the corners of the pattern to compute move analysis for exemple. 	
	
	\subsubsection{Others}
	
	\par My biggest parallel achivement is an algorithm that helps the user of the application to find the best threshold for his patterns. It depends of the number of pattern you want to recognize because often the threshold must be higher for certain conditions and more there is pattern in the image, more there is different conditions. 
	\par The algorithm take a scene and a pattern in input plus the number of time the pattern is represented in the image. The result of the algorithm is the first threshold that got all the patterns in the image. It computes a range of 150 values, that is why I can take 2 or 3 secondes sometimes.
	\newpage
	\begin{figure}[t]
		\begin{center}
			\includegraphics[width=10cm]{images_not_compressed/tester.png}
			\caption{Screenshot of the algorithm finding four times the MI unit pattern}
			\label{OutIn}	
		\end{center}
	\end{figure}	
	
	\par We can see here that four units has been found with, for each, the positions of the corners. The treshold and minimum hessian values used are printed on top of the image. This values are generally good, but they can be higher if it needs to be less specific.

=======
>>>>>>> da32cb58e77b0fbb34fe755b5f45d09f64c636a0
	
	\input{conclusion}

	\clearpage

	\bibliography{/home/manu/workspace/Scanner/Report/biblio_internship}{}
	\bibliographystyle{plain}

	\chapter{Annexes}
	
	\begin{itemize}
	\item
		\hypertarget{opencv}{\textbf{OpenCV tutorial :\\}}	\url{http://docs.opencv.org/doc/tutorials/features2d/feature_homography/feature_homography.html#feature-homography}\\

	\item
	\hypertarget{structDMatch}{\textbf{Code of the DMatch Structure :}}
	\begin{lstlisting}
struct DMatch
{
    DMatch() : queryIdx(-1), trainIdx(-1), imgIdx(-1),
               distance(std::numeric_limits<float>::max()) {}
    DMatch( int _queryIdx, int _trainIdx, float _distance ) :
            queryIdx(_queryIdx), trainIdx(_trainIdx), imgIdx(-1),
            distance(_distance) {}
    DMatch( int _queryIdx, int _trainIdx, int _imgIdx, float _distance ) :
            queryIdx(_queryIdx), trainIdx(_trainIdx), imgIdx(_imgIdx),
            distance(_distance) {}

    int queryIdx; // query descriptor index
    int trainIdx; // train descriptor index
    int imgIdx;   // train image index

    float distance;

    // less is better
    bool operator<( const DMatch &m ) const;
};
	\end{lstlisting}	
	
\end{itemize}		
	


	\listoffigures
		
	
	
	
	\input{summary}


	\par My internship took place in Fisciano, a little city at 15km of Salerno and 35km South of Napoli in Italia. I was working in the MIVIA laboratory: Macchine Intelligenti per il riconoscimento di Video, Immagini e Media. Which means intelligent machines for video, images and media recognition. They currently work for multinational companies to startups, they are specialized in computer vision and automatism. That is why they often work with drones and robots.
	\par My first project consisted in gathering information about the Motorola HC1 Helmet which is used by companies to provide hands free communication on the field. Then I had to replace the Windows CE operating system for a Linux. I tried a lot of things, but without the references of the components and the skills to erase Windows CE. I could not achieve this task.
	\par After three weeks working on the helmet, I finally switched to another project. A project that fitted more with my skills because I had to implement an image analysis algorithm based on OpenCV. I had to extract patterns on images. The main difficulty of this project was that the pattern could appear several times on the image and they were several patterns to be found each time. This project is a step of a bigger project that pretend to simplify the maintenance manuals by simply scan the machine you want to repair. Because the manuals are often big and a little part of the information concern your machine. The result of the analysis should pop a manual in pdf gathering only the information you need.
	\par I learned about OpenCV and tested code before I really worked on the project. The first version of the algorithm was not satisfying the need so I restarted from zero. Using what I have already done, I easily surpassed the previous algorithm with a new matching system and a strictness in organization. I made a github: \url{https://github.com/manumanmax/hardwarePatternDetection} and I often reported with my superior Pierluigi.
	\par I finally succeed in my task of suppressing the points representing each pattern when I found one, threshold the matcher and gathering the in a structure. Then Pierluigi asked me to create a video to showcase how the algorithm works.
	
	\par I acquired lots of skills in computer sciences, but also in embedded system, English and I learned a little bit of Italian. At school, I made 3 internships and this one was the most interesting and relevant. I really enjoyed it because both the place and the work were great.
	
	
	
\end{document}